name: cmake build

on: [push]

jobs:
  build:
    name: '${{ matrix.os }}: build'
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]

    steps:
    - uses: actions/checkout@v3
      with:
        submodules: true
    # Setup the build machine with the most recent versions of CMake and Ninja. Both are cached if not already: on subsequent runs both will be quickly restored from GitHub cache service.
    - uses: lukka/get-cmake@latest

    # This step will only be required for ubuntu
    - name: Install libudev on ubuntu
      run: sudo apt-get install -y libudev-dev
      if: matrix.os == 'ubuntu-latest'

    - name: run-cmake
      uses: lukka/run-cmake@v10.1
      with:
          # This is the default path to the CMakeLists.txt along side the
          # CMakePresets.json. Change if you need have CMakeLists.txt and CMakePresets.json
          # located elsewhere.
          # cmakeListsTxtPath: '${{ github.workspace }}/CMakeLists.txt'

          # This is the name of the CMakePresets.json's configuration to use to generate
          # the project files. This configuration leverages the vcpkg.cmake toolchain file to
          # run vcpkg and install all dependencies specified in vcpkg.json.
          configurePreset: 'ninja-release'

          # This is the name of the CMakePresets.json's configuration to build the project.
          buildPreset: 'ninja-release'
